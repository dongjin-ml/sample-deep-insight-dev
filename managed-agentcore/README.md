# Deep Insight: Managed-AgentCore Version

> Secure, customizable multi-agent system for large-scale data analysis on AWS Bedrock AgentCore

**Last Updated**: 2025-12-09

---

## üéØ Overview

A Multi-Agent system built on AWS Bedrock AgentCore Runtime that analyzes large data files (CSV, log files up to 1GB, JSON metadata), extracts insights with text and charts, and automatically generates DOCX reports.

- **Security**: Enterprise-grade with 100% private VPC network (AgentCore ‚Üî ALB ‚Üî Fargate)
- **Customization**: Custom Docker images, extensible agents, flexible data sources for your requirements
- **Architecture**: Strands Agent Framework on serverless Fargate with concurrent processing, long-running tasks, and Infrastructure as Code

## üöÄ Quick Start

### Tested Environments

macOS (arm64), Amazon EC2 (arm64)

### Prerequisites

| Tool | Version | Required For | Check Command |
|------|---------|--------------|---------------|
| AWS CLI | v2.x | All phases | `aws --version` |
| Docker | 20.x+ | Phase 2 | `docker --version` |
| jq | 1.6+ | Phase 3 | `jq --version` |
| uv | 0.4+ | Phase 3 | `uv --version` |
| Python | 3.12+ | Phase 4 | `python3 --version` |

```bash
# Quick verification (run from managed-agentcore/)
./production_deployment/scripts/check_prerequisites.sh

# Auto-install missing tools
./production_deployment/scripts/check_prerequisites.sh --install
```

> üìñ **[Detailed installation guide ‚Üí](production_deployment/docs/PREREQUISITES.md)** Step-by-step instructions for all platforms (Linux x86_64, ARM64, macOS)

### Production Deployment

Four-phase deployment:
1. **Phase 1**: VPC Infrastructure (CloudFormation)
2. **Phase 2**: Fargate Runtime (CloudFormation + Docker)
3. **Phase 3**: Environment Preparation (UV, Dependencies, Config)
4. **Phase 4**: AgentCore Runtime (Creation, Verification, Cleanup)

**Quick commands**:
```bash
# Phase 1 + 2: Infrastructure (Automated), Any region is possible (i.e. us-west-2)
cd production_deployment/scripts
./deploy_phase1_phase2.sh prod us-west-2

# Phase 3: Environment Setup
cd phase3
./01_extract_env_vars_from_cf.sh prod us-west-2  # Specify your deployment region
./02_create_uv_env.sh deep-insight
./03_patch_dockerignore.sh

# Phase 4: Runtime Creation and Testing
cd ../../../
uv run 01_create_agentcore_runtime_vpc.py  # Create runtime
uv run 02_invoke_agentcore_runtime_vpc.py  # Test runtime
uv run 03_download_artifacts.py            # Download results
```

> üì¶ **[What each script creates ‚Üí](production_deployment/docs/DEPLOYMENT_OUTPUTS.md)** AWS resources, environment variables, and local files generated by each phase

---

## üìä Architecture

### High-Level Flow

```
User Query + Data Files (CSV, JSON)
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  User (Bedrock AgentCore API)                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ invoke_runtime()
                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  AgentCore Runtime (VPC Private)                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ Coordinator (Strands Agent)                   ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  - Coder Agent ‚Üí Validator Agent ‚Üí Reporter   ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  - Multi-Agent Workflow Orchestration         ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ HTTP (Private)
                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Custom Code Interpreter (ECR + ALB + Fargate)          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ  Internal ALB ‚Üí Fargate Containers            ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  - Dynamic Python/Bash execution              ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  - Custom Docker image (your libraries)       ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  - Session-based with cookie management       ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Network Architecture

**100% Private Network** - No public internet access required:
- VPC Endpoints for AWS services (Bedrock, ECR, S3, CloudWatch Logs)
- NAT Gateway optional (VPC Endpoints handle all traffic)
- Private subnets for Fargate tasks
- Internal ALB for container routing

---

## ‚ú® Key Features

### Security
- üîí **Enterprise-Grade Security** - 100% private VPC with no public internet access
- üåê **AgentCore VPC Mode** - Runtime deployed in private subnets with VPC networking
- üîê **VPC Endpoints** - Private connectivity to AWS services (Bedrock, ECR, S3, CloudWatch)
- üõ°Ô∏è **Security Groups** - Least-privilege rules for AgentCore, ALB, Fargate, and VPC Endpoints

### Customization
- üíª **Custom Code Interpreter** - Your own Fargate-based Python/Bash executor with custom Docker image (ECR + ALB + Fargate)
- üê≥ **Custom Docker Image** - Add your own fonts, system libraries, and Python packages
- üìÇ **Flexible Data Sources** - Support for large CSV files, text, log files (i.e. 1 GB), and metadata (i.e. JSON)
- üõ†Ô∏è **Extensible Agents** - Modify prompts and add new agents to fit your requirements

### Architecture & Infrastructure
- üîÑ **Strands Agent Framework** - Adapted to Bedrock AgentCore with custom code interpreter on serverless Fargate
- ‚ö° **Concurrent Processing** - Multiple simultaneous requests via AgentCore MicroVM and Fargate containers
- ‚è±Ô∏è **Long-Running Agent Tasks** - AgentCore and Fargate containers with adjustable vCPU/RAM for extended agent workflows
- ‚òÅÔ∏è **Infrastructure as Code** - CloudFormation nested stacks for reproducible deployments

### Multi-Agent Workflow

Orchestrated by Coordinator ‚Üí Planner ‚Üí Supervisor (see [self-hosted](../self-hosted) for details):
- üìä **Coder Agent** - Automated data analysis and calculations
- ‚úÖ **Validator Agent** - Result validation and citation generation
- üìÑ **Reporter Agent** - Automatic DOCX report generation
- üìã **Tracker Agent** - Workflow progress monitoring and task tracking

> üìñ **[Compare with Self-Hosted ‚Üí](production_deployment/docs/DEPLOYMENT_COMPARISON.md)** When to choose each option, feature comparison, and migration path

---

## üìÅ Project Structure

```
.
‚îú‚îÄ‚îÄ production_deployment/       # üèóÔ∏è Deployment (CloudFormation + Scripts)
‚îÇ   ‚îú‚îÄ‚îÄ cloudformation/          # Infrastructure templates
‚îÇ   ‚îú‚îÄ‚îÄ scripts/                 # Phase 1-4 deployment scripts
‚îÇ   ‚îî‚îÄ‚îÄ docs/                    # Deployment documentation
‚îÇ
‚îú‚îÄ‚îÄ src/                         # ü§ñ Agent Source Code
‚îÇ   ‚îú‚îÄ‚îÄ graph/                   # Workflow definitions
‚îÇ   ‚îú‚îÄ‚îÄ tools/                   # Agent tools
‚îÇ   ‚îú‚îÄ‚îÄ prompts/                 # System prompts
‚îÇ   ‚îî‚îÄ‚îÄ utils/                   # Utilities
‚îÇ
‚îú‚îÄ‚îÄ fargate-runtime/             # üê≥ Fargate Container
‚îÇ   ‚îú‚îÄ‚îÄ code_executor_server.py  # HTTP server for code execution
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile               # Container image
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt         # Python dependencies
‚îÇ
‚îú‚îÄ‚îÄ data/                        # üìÇ Input data files
‚îÇ
‚îú‚îÄ‚îÄ 01_create_agentcore_runtime_vpc.py  # Runtime creation
‚îú‚îÄ‚îÄ 02_invoke_agentcore_runtime_vpc.py  # Runtime testing
‚îú‚îÄ‚îÄ 03_download_artifacts.py            # Download results
‚îî‚îÄ‚îÄ README.md
```

---

## üîß Customization

Customize the deployment for your needs:
- **Use your own data** - Add CSV/JSON files under `data/`
- **Change agent model IDs** - Configure different Claude models per agent in `.env`
- **Modify dependencies** - Edit `fargate-runtime/requirements.txt`
- **Customize Docker image** - Edit `fargate-runtime/Dockerfile`
- **Modify agent prompts** - Edit files in `src/prompts/`

> üìñ **[Customization Guide ‚Üí](production_deployment/docs/CUSTOMIZATION.md)** Detailed instructions for each customization option

---

## üåç Multi-Region Support

Supports deployment to **9 AWS regions**:
- üá∫üá∏ US East (N. Virginia, Ohio), US West (Oregon)
- üåè Asia Pacific (Mumbai, Singapore, Sydney, Tokyo)
- üá™üá∫ Europe (Ireland, Frankfurt)

**Important**: AZ names are account-specific. Always verify AZ mappings before deploying to new accounts/regions.

**‚Üí [docs/MULTI_REGION_DEPLOYMENT.md](production_deployment/docs/MULTI_REGION_DEPLOYMENT.md)**

---

## üóëÔ∏è Cleanup

### Recommended: Two-Step Cleanup

Due to ENI (Elastic Network Interface) release timing, **cleanup requires two steps**:

```bash
# Step 1: Delete Phase 4 (AgentCore Runtime)
cd production_deployment/scripts/phase4
./cleanup.sh prod --region us-west-2

# Step 2: Wait ~6 hours for ENI release, then delete remaining phases
cd production_deployment/scripts
./cleanup_all.sh prod us-west-2
```

**‚ö†Ô∏è Why two steps?** AgentCore Runtime creates ENIs in your VPC. These ENIs take ~6 hours to be released after runtime deletion. Phase 1/2 cleanup will fail if ENIs are still attached.

### What Gets Deleted

- Phase 4: AgentCore Runtime + CloudWatch logs
- Phase 3: UV environment, .env file, symlinks
- Phase 2: ECS cluster, ECR repository, Docker images
- Phase 1: VPC, subnets, security groups, ALB, IAM roles
- S3 buckets (templates + session data)

### Manual Cleanup (Individual Phases)

```bash
# Phase 4: Delete Runtime
cd production_deployment/scripts/phase4
./cleanup.sh prod --region us-west-2

# ‚è≥ Wait ~6 hours for ENI release before proceeding

# Phase 3: Delete local environment (manual)
cd managed-agentcore
rm -rf .venv .env pyproject.toml
rm -rf production_deployment/scripts/phase3/.venv production_deployment/scripts/phase3/uv.lock

# Phase 2: Delete Fargate resources
cd production_deployment/scripts/phase2
./cleanup.sh prod --region us-west-2

# Phase 1: Delete VPC infrastructure
cd production_deployment/scripts/phase1
./cleanup.sh prod --region us-west-2
```

---

## üìö Documentation

- **[production_deployment/docs/CUSTOMIZATION.md](production_deployment/docs/CUSTOMIZATION.md)** - Use your own data, modify dependencies, customize Docker image
- **[production_deployment/docs/DEPLOYMENT_COMPARISON.md](production_deployment/docs/DEPLOYMENT_COMPARISON.md)** - Self-Hosted vs Managed AgentCore comparison
- **[production_deployment/docs/DEPLOYMENT_OUTPUTS.md](production_deployment/docs/DEPLOYMENT_OUTPUTS.md)** - What each script creates
- **[production_deployment/docs/MULTI_REGION_DEPLOYMENT.md](production_deployment/docs/MULTI_REGION_DEPLOYMENT.md)** - Multi-region deployment
- **[production_deployment/scripts/README.md](production_deployment/scripts/README.md)** - Scripts reference

---

## üìù License

MIT License

---


